<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seine_05b: Calibration of an open-loop influenced flow semi-distributed GR6J model network • airGRiwrm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Seine_05b: Calibration of an open-loop influenced flow semi-distributed GR6J model network">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">airGRiwrm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../articles/airGRiwrm.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li class="dropdown-header">Quick start on the Severn River (UK)</li>
    <li>
      <a href="../../articles/V01_Structure_SD_model.html">Severn_01: Set up of a semi-distributed GR model network</a>
    </li>
    <li>
      <a href="../../articles/V02_Calibration_SD_model.html">Severn_02: Calibration of a GR4J semi-distributed model network</a>
    </li>
    <li>
      <a href="../../articles/V03_Open-loop_influenced_flow.html">Severn_03: Calibration of an open-loop influenced flow model network</a>
    </li>
    <li>
      <a href="../../articles/V04_Closed-loop_regulated_withdrawal.html">Severn_04: Simulation of a regulated withdrawal (closed-loop control)</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Example of a large network on the Seine River (France)</li>
    <li>
      <a href="../../articles/seinebasin/V01_First_network.html">Seine_01: Structuration of a semi-distributed GR4J model network</a>
    </li>
    <li>
      <a href="../../articles/seinebasin/V02_First_run.html">Seine_02: Run a semi-distributed GR model network</a>
    </li>
    <li>
      <a href="../../articles/seinebasin/V03_First_Calibration.html">Seine_03: Calibration of a semi-distributed GR model network</a>
    </li>
    <li>
      <a href="../../articles/seinebasin/V04_Open-loop_influenced_flow.html">Seine_04: Running open-loop influenced flow semi-distributed model network</a>
    </li>
    <li>
      <a href="../../articles/seinebasin/V05_Open-loop_influenced_flow_calibration.html">Seine_05: Calibration of an open-loop influenced flow semi-distributed model network</a>
    </li>
    <li>
      <a href="../../articles/seinebasin/V05b_Open-loop_influenced_flow_calibration_GR6J.html">Seine_05b: Calibration of an open-loop influenced flow semi-distributed GR6J model network</a>
    </li>
    <li>
      <a href="../../articles/seinebasin/V06_Naturalised_flow_simulation.html">Seine_06: Simulate naturalized flows with a model network calibrated with influenced flows</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    airGR Galaxy

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://hydrogr.github.io/airGR/" class="external-link">airGR</a>
    </li>
    <li>
      <a href="https://CRAN.R-project.org/package=airGRdatassim" class="external-link">airGRdatassim R-package</a>
    </li>
    <li>
      <a href="https://sunshine.irstea.fr/app/airGRmaps" class="external-link">airGRmaps web app</a>
    </li>
    <li>
      <a href="https://hydroGR.github.io/airGRteaching/" class="external-link">airGRteaching R-package</a>
    </li>
    <li>
      <a href="https://sunshine.irstea.fr/app/airGRteaching" class="external-link">airGRteaching web app</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/inrae/airGRiwrm" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
<li>
  <a href="https://gitlab.irstea.fr/in-wop/airGRiwrm" class="external-link">
    <span class="fab fa-gitlab fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><link href="V05b_Open-loop_influenced_flow_calibration_GR6J_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="V05b_Open-loop_influenced_flow_calibration_GR6J_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="V05b_Open-loop_influenced_flow_calibration_GR6J_files/d3-3.3.8/d3.min.js"></script><script src="V05b_Open-loop_influenced_flow_calibration_GR6J_files/dagre-0.4.0/dagre-d3.min.js"></script><link href="V05b_Open-loop_influenced_flow_calibration_GR6J_files/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet">
<script src="V05b_Open-loop_influenced_flow_calibration_GR6J_files/mermaid-0.3.0/dist/mermaid.slim.min.js"></script><link href="V05b_Open-loop_influenced_flow_calibration_GR6J_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="V05b_Open-loop_influenced_flow_calibration_GR6J_files/chromatography-0.1/chromatography.js"></script><script src="V05b_Open-loop_influenced_flow_calibration_GR6J_files/DiagrammeR-binding-1.0.11/DiagrammeR.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Seine_05b: Calibration of an open-loop
influenced flow semi-distributed GR6J model network</h1>
                        <h4 data-toc-skip class="author">David
Dorchies</h4>
            
      

      <div class="hidden name"><code>V05b_Open-loop_influenced_flow_calibration_GR6J.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inrae.github.io/airGRiwrm/">airGRiwrm</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: airGR</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'airGRiwrm'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:airGR':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Calibration, CreateCalibOptions, CreateInputsCrit,</span></span>
<span><span class="co">#&gt;     CreateInputsModel, CreateRunOptions, RunModel</span></span></code></pre></div>
<p>As in vignette V05, this vignette proposes an example of calibration
of influenced flow with the Marne reservoir but here with the GR6J model
instead of GR4J. It will use influenced observation flows directly
measured at gauging stations and flows recorded at reservoir inlets and
outlets.</p>
<div class="section level2">
<h2 id="set-the-data">Set the data<a class="anchor" aria-label="anchor" href="#set-the-data"></a>
</h2>
<p>Loading naturalized data and influenced flow configuration:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#load("_cache/V01.RData")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"_cache/V04.RData"</span><span class="op">)</span></span></code></pre></div>
<p>We remove extra items from a complete configuration to keep only the
Marne system:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selectedNodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MARNE_P23"</span>, <span class="st">"STDIZ_04"</span>, <span class="st">"LOUVE_19"</span>, <span class="st">"VITRY_25"</span>, <span class="st">"MARNE_P28"</span>, <span class="st">"MARNE_R25"</span>, <span class="st">"CHALO_21"</span>, <span class="st">"MONTR_18"</span>, <span class="st">"NOISI_17"</span><span class="op">)</span></span>
<span><span class="va">griwrm3</span> <span class="op">&lt;-</span> <span class="va">griwrm2</span><span class="op">[</span><span class="va">griwrm2</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">selectedNodes</span>,<span class="op">]</span></span>
<span><span class="va">griwrm3</span><span class="op">$</span><span class="va">model</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">griwrm3</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"RunModel_GR6J"</span></span>
<span><span class="va">griwrm3</span><span class="op">[</span><span class="va">griwrm3</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="st">"NOISI_17"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"down"</span>, <span class="st">"length"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="co"># Downstream station instead of PARIS_05</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">griwrm3</span><span class="op">)</span></span></code></pre></div>
<div class="DiagrammeR html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"graph LR\nSTDIZ_04 -->| 86 km| CHALO_21\nMONTR_18 -->| 38 km| NOISI_17\nLOUVE_19 -->| 86 km| CHALO_21\nCHALO_21 -->| 238 km| NOISI_17\nVITRY_25 -->| 38 km| CHALO_21\nMARNE_P23 -->| 3 km| STDIZ_04\nMARNE_P28 -->| 82 km| CHALO_21\nMARNE_R25 -->| 57 km| CHALO_21\nstyle CHALO_21 fill:#cfc\nstyle NOISI_17 fill:#cfc\nstyle STDIZ_04 fill:#cfc\nstyle MARNE_P23 fill:#fcc\nstyle MARNE_P28 fill:#fcc\nstyle MARNE_R25 fill:#fcc"},"evals":[],"jsHooks":[]}</script><p>We can now generate the new <code>GRiwrmInputsModel</code>
object:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">seinebasin</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">QOBS</span><span class="op">)</span></span>
<span><span class="va">iEnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">DatesR</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2008-07-31"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Qreservoirs</span><span class="op">)</span></span>
<span><span class="va">QresMarne</span> <span class="op">&lt;-</span> <span class="va">Qreservoirs</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">iEnd</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"MARNE"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Qreservoirs</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">id_GR_nodes</span> <span class="op">&lt;-</span> <span class="va">griwrm3</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">griwrm3</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">InputsModel3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/CreateInputsModel.html">CreateInputsModel</a></span><span class="op">(</span><span class="va">griwrm3</span>,</span>
<span>                                  <span class="va">DatesR</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">iEnd</span><span class="op">]</span>,</span>
<span>                                  <span class="va">Precip</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">iEnd</span>, <span class="va">id_GR_nodes</span><span class="op">]</span>,</span>
<span>                                  <span class="va">PotEvap</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">iEnd</span>, <span class="va">id_GR_nodes</span><span class="op">]</span>,</span>
<span>                                  <span class="va">QresMarne</span><span class="op">)</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Treating sub-basin STDIZ_04...</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Treating sub-basin MONTR_18...</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Treating sub-basin LOUVE_19...</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Treating sub-basin VITRY_25...</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Treating sub-basin CHALO_21...</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Treating sub-basin NOISI_17...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="griwmrunoptions-object">GriwmRunOptions object<a class="anchor" aria-label="anchor" href="#griwmrunoptions-object"></a>
</h2>
<p>We first define the run period:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IndPeriod_Run</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq.int</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">DatesR</span> <span class="op">==</span> <span class="op">(</span><span class="va">DatesR</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">*</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">60</span><span class="op">)</span><span class="op">)</span>, <span class="co"># Set aside warm-up period</span></span>
<span>  <span class="va">iEnd</span> <span class="co"># Until the end of the time series</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We define the (optional but recommended) warm up period as a one-year
period before the run period:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IndPeriod_WarmUp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq.int</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">IndPeriod_Run</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RunOptions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/CreateRunOptions.html">CreateRunOptions</a></span><span class="op">(</span></span>
<span>  <span class="va">InputsModel3</span>,</span>
<span>  IndPeriod_WarmUp <span class="op">=</span> <span class="va">IndPeriod_WarmUp</span>,</span>
<span>  IndPeriod_Run <span class="op">=</span> <span class="va">IndPeriod_Run</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="inputscrit-object">InputsCrit object<a class="anchor" aria-label="anchor" href="#inputscrit-object"></a>
</h2>
<p>We define the objective function for the calibration:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">InputsCrit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/CreateInputsCrit.html">CreateInputsCrit</a></span><span class="op">(</span></span>
<span>  InputsModel <span class="op">=</span> <span class="va">InputsModel3</span>,</span>
<span>  FUN_CRIT <span class="op">=</span> <span class="va">ErrorCrit_KGE2</span>,</span>
<span>  RunOptions <span class="op">=</span> <span class="va">RunOptions</span>, Obs <span class="op">=</span> <span class="va">Qobs</span><span class="op">[</span><span class="va">IndPeriod_Run</span>,<span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="griwrmcaliboptions-object">GRiwrmCalibOptions object<a class="anchor" aria-label="anchor" href="#griwrmcaliboptions-object"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CalibOptions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/CreateCalibOptions.html">CreateCalibOptions</a></span><span class="op">(</span><span class="va">InputsModel3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">CalibOptions</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 6</span></span>
<span><span class="co">#&gt;  $ STDIZ_04:List of 4</span></span>
<span><span class="co">#&gt;   ..$ FixedParam       : logi [1:7] NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;   ..$ SearchRanges     : num [1:2, 1:7] 1.00e-02 2.00e+01 4.59e-05 2.18e+04 -1.09e+04 ...</span></span>
<span><span class="co">#&gt;   ..$ FUN_TRANSFO      :function (ParamIn, Direction)  </span></span>
<span><span class="co">#&gt;   ..$ StartParamDistrib: num [1:3, 1:7] 1.25 2.5 5 36.6 49.4 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:5] "CalibOptions" "daily" "GR" "SD" ...</span></span>
<span><span class="co">#&gt;  $ MONTR_18:List of 4</span></span>
<span><span class="co">#&gt;   ..$ FixedParam       : logi [1:6] NA NA NA NA NA NA</span></span>
<span><span class="co">#&gt;   ..$ SearchRanges     : num [1:2, 1:6] 4.59e-05 2.18e+04 -1.09e+04 1.09e+04 4.59e-05 ...</span></span>
<span><span class="co">#&gt;   ..$ FUN_TRANSFO      :function (ParamIn, Direction)  </span></span>
<span><span class="co">#&gt;   ..$ StartParamDistrib: num [1:3, 1:6] 36.598 49.402 90.017 -1.175 -0.521 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:4] "CalibOptions" "daily" "GR" "HBAN"</span></span>
<span><span class="co">#&gt;  $ LOUVE_19:List of 4</span></span>
<span><span class="co">#&gt;   ..$ FixedParam       : logi [1:6] NA NA NA NA NA NA</span></span>
<span><span class="co">#&gt;   ..$ SearchRanges     : num [1:2, 1:6] 4.59e-05 2.18e+04 -1.09e+04 1.09e+04 4.59e-05 ...</span></span>
<span><span class="co">#&gt;   ..$ FUN_TRANSFO      :function (ParamIn, Direction)  </span></span>
<span><span class="co">#&gt;   ..$ StartParamDistrib: num [1:3, 1:6] 36.598 49.402 90.017 -1.175 -0.521 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:4] "CalibOptions" "daily" "GR" "HBAN"</span></span>
<span><span class="co">#&gt;  $ VITRY_25:List of 4</span></span>
<span><span class="co">#&gt;   ..$ FixedParam       : logi [1:6] NA NA NA NA NA NA</span></span>
<span><span class="co">#&gt;   ..$ SearchRanges     : num [1:2, 1:6] 4.59e-05 2.18e+04 -1.09e+04 1.09e+04 4.59e-05 ...</span></span>
<span><span class="co">#&gt;   ..$ FUN_TRANSFO      :function (ParamIn, Direction)  </span></span>
<span><span class="co">#&gt;   ..$ StartParamDistrib: num [1:3, 1:6] 36.598 49.402 90.017 -1.175 -0.521 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:4] "CalibOptions" "daily" "GR" "HBAN"</span></span>
<span><span class="co">#&gt;  $ CHALO_21:List of 4</span></span>
<span><span class="co">#&gt;   ..$ FixedParam       : logi [1:7] NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;   ..$ SearchRanges     : num [1:2, 1:7] 1.00e-02 2.00e+01 4.59e-05 2.18e+04 -1.09e+04 ...</span></span>
<span><span class="co">#&gt;   ..$ FUN_TRANSFO      :function (ParamIn, Direction)  </span></span>
<span><span class="co">#&gt;   ..$ StartParamDistrib: num [1:3, 1:7] 1.25 2.5 5 36.6 49.4 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:5] "CalibOptions" "daily" "GR" "SD" ...</span></span>
<span><span class="co">#&gt;  $ NOISI_17:List of 4</span></span>
<span><span class="co">#&gt;   ..$ FixedParam       : logi [1:7] NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;   ..$ SearchRanges     : num [1:2, 1:7] 1.00e-02 2.00e+01 4.59e-05 2.18e+04 -1.09e+04 ...</span></span>
<span><span class="co">#&gt;   ..$ FUN_TRANSFO      :function (ParamIn, Direction)  </span></span>
<span><span class="co">#&gt;   ..$ StartParamDistrib: num [1:3, 1:7] 1.25 2.5 5 36.6 49.4 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "class")= chr [1:5] "CalibOptions" "daily" "GR" "SD" ...</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:2] "GRiwrmCalibOptions" "list"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calibration">Calibration<a class="anchor" aria-label="anchor" href="#calibration"></a>
</h2>
<p>The optimization (i.e. calibration) of parameters can now be
performed:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OutputsCalib</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/Calibration.html">Calibration</a></span><span class="op">(</span><span class="va">InputsModel3</span>, <span class="va">RunOptions</span>, <span class="va">InputsCrit</span>, <span class="va">CalibOptions</span><span class="op">)</span></span>
<span><span class="co">#&gt; Calibration.GRiwrmInputsModel: Treating sub-basin STDIZ_04...</span></span>
<span><span class="co">#&gt; Grid-Screening in progress (0% 20% 40% 60% 80% 100%)</span></span>
<span><span class="co">#&gt;   Screening completed (2187 runs)</span></span>
<span><span class="co">#&gt;       Param =    5.000,   36.598,   -0.521,   60.340,    2.345,    0.220,   20.086</span></span>
<span><span class="co">#&gt;       Crit. KGE2[Q]      = 0.7947</span></span>
<span><span class="co">#&gt; Steepest-descent local search in progress</span></span>
<span><span class="co">#&gt;   Calibration completed (211 iterations, 5129 runs)</span></span>
<span><span class="co">#&gt;       Param =   19.990,  162.474,   -0.050,   38.741,    3.693,    0.109,    4.721</span></span>
<span><span class="co">#&gt;       Crit. KGE2[Q]      = 0.9195</span></span>
<span><span class="co">#&gt; Calibration.GRiwrmInputsModel: Treating sub-basin MONTR_18...</span></span>
<span><span class="co">#&gt; Grid-Screening in progress (0% 20% 40% 60% 80% 100%)</span></span>
<span><span class="co">#&gt;   Screening completed (729 runs)</span></span>
<span><span class="co">#&gt;       Param =   90.017,   -0.521,   60.340,    2.345,    0.220,   20.086</span></span>
<span><span class="co">#&gt;       Crit. KGE2[Q]      = 0.7904</span></span>
<span><span class="co">#&gt; Steepest-descent local search in progress</span></span>
<span><span class="co">#&gt;   Calibration completed (79 iterations, 1699 runs)</span></span>
<span><span class="co">#&gt;       Param =  175.611,   -0.318,   46.474,    2.412,    0.272,    6.006</span></span>
<span><span class="co">#&gt;       Crit. KGE2[Q]      = 0.8382</span></span>
<span><span class="co">#&gt; Calibration.GRiwrmInputsModel: Treating sub-basin LOUVE_19...</span></span>
<span><span class="co">#&gt; Grid-Screening in progress (0% 20% 40% 60% 80% 100%)</span></span>
<span><span class="co">#&gt;   Screening completed (729 runs)</span></span>
<span><span class="co">#&gt;       Param =   49.402,   -0.521,   60.340,    2.345,    0.020,   20.086</span></span>
<span><span class="co">#&gt;       Crit. KGE2[Q]      = 0.9127</span></span>
<span><span class="co">#&gt; Steepest-descent local search in progress</span></span>
<span><span class="co">#&gt;   Calibration completed (33 iterations, 1099 runs)</span></span>
<span><span class="co">#&gt;       Param =   58.518,   -0.521,   94.421,    2.221,    0.026,   14.515</span></span>
<span><span class="co">#&gt;       Crit. KGE2[Q]      = 0.9290</span></span>
<span><span class="co">#&gt; Calibration.GRiwrmInputsModel: Treating sub-basin VITRY_25...</span></span>
<span><span class="co">#&gt; Grid-Screening in progress (0% 20% 40% 60% 80% 100%)</span></span>
<span><span class="co">#&gt;   Screening completed (729 runs)</span></span>
<span><span class="co">#&gt;       Param =   36.598,   -0.521,  148.413,    2.345,    0.020,   20.086</span></span>
<span><span class="co">#&gt;       Crit. KGE2[Q]      = 0.9197</span></span>
<span><span class="co">#&gt; Steepest-descent local search in progress</span></span>
<span><span class="co">#&gt;   Calibration completed (56 iterations, 1394 runs)</span></span>
<span><span class="co">#&gt;       Param =   33.665,   -0.521,  163.534,    3.691,    0.043,   16.471</span></span>
<span><span class="co">#&gt;       Crit. KGE2[Q]      = 0.9473</span></span>
<span><span class="co">#&gt; Calibration.GRiwrmInputsModel: Treating sub-basin CHALO_21...</span></span>
<span><span class="co">#&gt; Grid-Screening in progress (0% 20% 40% 60% 80% 100%)</span></span>
<span><span class="co">#&gt;   Screening completed (2187 runs)</span></span>
<span><span class="co">#&gt;       Param =    1.250,   90.017,   -1.175,  148.413,    1.369,    0.020,  148.413</span></span>
<span><span class="co">#&gt;       Crit. KGE2[Q]      = 0.9181</span></span>
<span><span class="co">#&gt; Steepest-descent local search in progress</span></span>
<span><span class="co">#&gt;   Calibration completed (93 iterations, 3462 runs)</span></span>
<span><span class="co">#&gt;       Param =    0.409,  616.307,   -1.175,  478.348,    2.344,    0.026,    3.882</span></span>
<span><span class="co">#&gt;       Crit. KGE2[Q]      = 0.9560</span></span>
<span><span class="co">#&gt; Calibration.GRiwrmInputsModel: Treating sub-basin NOISI_17...</span></span>
<span><span class="co">#&gt; Grid-Screening in progress (0% 20% 40% 60% 80% 100%)</span></span>
<span><span class="co">#&gt;   Screening completed (2187 runs)</span></span>
<span><span class="co">#&gt;       Param =    1.250,   90.017,   -1.175,  148.413,    2.345,    0.220,  148.413</span></span>
<span><span class="co">#&gt;       Crit. KGE2[Q]      = 0.8476</span></span>
<span><span class="co">#&gt; Steepest-descent local search in progress</span></span>
<span><span class="co">#&gt;   Calibration completed (84 iterations, 3358 runs)</span></span>
<span><span class="co">#&gt;       Param =    1.146,  828.119,   -1.175,  171.034,    2.219,    0.217,   36.077</span></span>
<span><span class="co">#&gt;       Crit. KGE2[Q]      = 0.9489</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-model-with-michel-calibration">Run model with Michel calibration<a class="anchor" aria-label="anchor" href="#run-model-with-michel-calibration"></a>
</h2>
<p>Now that the model is calibrated, we can run it with the optimized
parameter values:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Param5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">griwrm3</span><span class="op">$</span><span class="va">id</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="va">OutputsCalib</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Param</span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">OutputsModels3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/RunModel.html">RunModel</a></span><span class="op">(</span></span>
<span>  <span class="va">InputsModel3</span>,</span>
<span>  RunOptions <span class="op">=</span> <span class="va">RunOptions</span>,</span>
<span>  Param <span class="op">=</span> <span class="va">Param5</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Treating sub-basin STDIZ_04...</span></span>
<span><span class="co">#&gt; Warning in RunModel_Lag(InputsModel, RunOptions, Param[1], OutputsModel): 115</span></span>
<span><span class="co">#&gt; time steps with negative flow, set to zero.</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Treating sub-basin MONTR_18...</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Treating sub-basin LOUVE_19...</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Treating sub-basin VITRY_25...</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Treating sub-basin CHALO_21...</span></span>
<span><span class="co">#&gt; Warning in RunModel_Lag(InputsModel, RunOptions, Param[1], OutputsModel): 11</span></span>
<span><span class="co">#&gt; time steps with negative flow, set to zero.</span></span>
<span><span class="co">#&gt; Warning in RunModel_Lag(InputsModel, RunOptions, Param[1], OutputsModel): 3</span></span>
<span><span class="co">#&gt; time steps with NA values</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Treating sub-basin NOISI_17...</span></span>
<span><span class="co">#&gt; Warning in RunModel_Lag(InputsModel, RunOptions, Param[1], OutputsModel): 6</span></span>
<span><span class="co">#&gt; time steps with NA values</span></span></code></pre></div>
<div class="section level3">
<h3 id="comparison-with-simulated-flows">Comparison with simulated flows<a class="anchor" aria-label="anchor" href="#comparison-with-simulated-flows"></a>
</h3>
<p>We can compare these simulated flows with influenced discharge
measurements:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="va">griwrm3</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">griwrm3</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">Q3</span> <span class="op">&lt;-</span> <span class="va">Qobs</span><span class="op">[</span><span class="va">RunOptions</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">IndPeriod_Run</span>, <span class="va">x</span><span class="op">]</span></span>
<span>    <span class="va">iQ3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Q3</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">IndPeriod_Obs</span> <span class="op">&lt;-</span> <span class="va">iQ3</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">iQ3</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">OutputsModels</span> <span class="op">&lt;-</span> <span class="fu">ReduceOutputsModel</span><span class="op">(</span><span class="va">OutputsModels3</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, <span class="va">IndPeriod_Obs</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">OutputsModels</span>, Qobs <span class="op">=</span> <span class="va">Q3</span><span class="op">[</span><span class="va">IndPeriod_Obs</span><span class="op">]</span>, main <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in plot.OutputsModel(OutputsModels, Qobs = Q3[IndPeriod_Obs], main =</span></span>
<span><span class="co">#&gt; x): zeroes detected in 'Qsim': some plots in the log space will not be created</span></span>
<span><span class="co">#&gt; using all time-steps</span></span></code></pre></div>
<p><img src="V05b_Open-loop_influenced_flow_calibration_GR6J_files/figure-html/plot-1.png" width="768"><img src="V05b_Open-loop_influenced_flow_calibration_GR6J_files/figure-html/plot-2.png" width="768"><img src="V05b_Open-loop_influenced_flow_calibration_GR6J_files/figure-html/plot-3.png" width="768"><img src="V05b_Open-loop_influenced_flow_calibration_GR6J_files/figure-html/plot-4.png" width="768"><img src="V05b_Open-loop_influenced_flow_calibration_GR6J_files/figure-html/plot-5.png" width="768"><img src="V05b_Open-loop_influenced_flow_calibration_GR6J_files/figure-html/plot-6.png" width="768"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Dorchies.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
