<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Severn_03: Calibration of an open-loop influenced flow model network • airGRiwrm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Severn_03: Calibration of an open-loop influenced flow model network">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">airGRiwrm</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.6.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/airGRiwrm.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li class="dropdown-header">Quick start on the Severn River (UK)</li>
    <li>
      <a href="../articles/V01_Structure_SD_model.html">Severn_01: Set up of a semi-distributed GR model network</a>
    </li>
    <li>
      <a href="../articles/V02_Calibration_SD_model.html">Severn_02: Calibration of a GR4J semi-distributed model network</a>
    </li>
    <li>
      <a href="../articles/V03_Open-loop_influenced_flow.html">Severn_03: Calibration of an open-loop influenced flow model network</a>
    </li>
    <li>
      <a href="../articles/V04_Closed-loop_regulated_withdrawal.html">Severn_04: Modeling a regulated withdrawal (closed-loop control)</a>
    </li>
    <li>
      <a href="../articles/V05_Modelling_ungauged_nodes.html">Severn_05: Modeling ungauged stations</a>
    </li>
    <li>
      <a href="../articles/V06_Modelling_regulated_diversion.html">Severn_06: Modeling a regulated diversion</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Example of a large network on the Seine River (France)</li>
    <li>
      <a href="../articles/seinebasin/V01_First_network.html">Seine_01: Structuration of a semi-distributed GR4J model network</a>
    </li>
    <li>
      <a href="../articles/seinebasin/V02_First_run.html">Seine_02: Run a semi-distributed GR model network</a>
    </li>
    <li>
      <a href="../articles/seinebasin/V03_First_Calibration.html">Seine_03: Calibration of a semi-distributed GR model network</a>
    </li>
    <li>
      <a href="../articles/seinebasin/V04_Open-loop_influenced_flow.html">Seine_04: Running open-loop influenced flow semi-distributed model network</a>
    </li>
    <li>
      <a href="../articles/seinebasin/V05_Open-loop_influenced_flow_calibration.html">Seine_05: Calibration of an open-loop influenced flow semi-distributed model network</a>
    </li>
    <li>
      <a href="../articles/seinebasin/V05b_Open-loop_influenced_flow_calibration_GR6J.html">Seine_05b: Calibration of an open-loop influenced flow semi-distributed GR6J model network</a>
    </li>
    <li>
      <a href="../articles/seinebasin/V06_Naturalised_flow_simulation.html">Seine_06: Simulate naturalized flows with a model network calibrated with influenced flows</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    airGR Galaxy

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://hydrogr.github.io/airGR/" class="external-link">airGR</a>
    </li>
    <li>
      <a href="https://CRAN.R-project.org/package=airGRdatassim" class="external-link">airGRdatassim R-package</a>
    </li>
    <li>
      <a href="https://sunshine.irstea.fr/app/airGRmaps" class="external-link">airGRmaps web app</a>
    </li>
    <li>
      <a href="https://hydroGR.github.io/airGRteaching/" class="external-link">airGRteaching R-package</a>
    </li>
    <li>
      <a href="https://sunshine.irstea.fr/app/airGRteaching" class="external-link">airGRteaching web app</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/inrae/airGRiwrm" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
<li>
  <a href="https://gitlab.irstea.fr/in-wop/airGRiwrm" class="external-link">
    <span class="fab fa-gitlab fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Severn_03: Calibration of an open-loop
influenced flow model network</h1>
                        <h4 data-toc-skip class="author">David
Dorchies</h4>
            
      
      <small class="dont-index">Source: <a href="https://gitlab.irstea.fr/in-wop/airGRiwrm/-/blob/master/vignettes/V03_Open-loop_influenced_flow.Rmd" class="external-link"><code>vignettes/V03_Open-loop_influenced_flow.Rmd</code></a></small>
      <div class="hidden name"><code>V03_Open-loop_influenced_flow.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inrae.github.io/airGRiwrm/">airGRiwrm</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: airGR</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'airGRiwrm'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:airGR':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Calibration, CreateCalibOptions, CreateInputsCrit,</span></span>
<span><span class="co">#&gt;     CreateInputsModel, CreateRunOptions, RunModel</span></span></code></pre></div>
<div class="section level3">
<h3 id="presentation-of-the-study-case">Presentation of the study case<a class="anchor" aria-label="anchor" href="#presentation-of-the-study-case"></a>
</h3>
<p>The calibration results shown in vignette ‘V02_Calibration_SD_model’
for the flows simulated on the Avon at Evesham (Gauging station ‘54002’)
and on the Severn at Buildwas (Gauging station ‘54095’) are not fully
satisfactory, especially regarding low flows. These upper basins are
actually heavily influenced by impoundments and inter-basin transfers
<span class="citation">(Higgs and Petts 1988)</span>.</p>
<p>So, to cope with these influences, in this vignette, we use direct
injection of observed influenced flows instead of modeling natural flow
with an hydrological model.</p>
<p>We use observation on the Avon at Evesham (Gauging station ‘54002’)
and we choose to do the same on the Severn at Bewdley (Gauging station
‘54001’) as if the observed flow at these locations would be the
observed release of a dam.</p>
<p>Please note that the flow on the Severn at Buildwas (Gauging station
‘54095’) is still simulated but its flows is no longer routed to
downstream.</p>
</div>
<div class="section level3">
<h3 id="conversion-of-a-gauging-station-into-a-release-spot">Conversion of a gauging station into a release spot<a class="anchor" aria-label="anchor" href="#conversion-of-a-gauging-station-into-a-release-spot"></a>
</h3>
<div class="section level4">
<h4 id="modification-of-the-griwrm-object">Modification of the GRiwrm object<a class="anchor" aria-label="anchor" href="#modification-of-the-griwrm-object"></a>
</h4>
<p>The creation of the <code>GRiwrm</code> object is detailed in the
vignette “V01_Structure_SD_model” of the package. The following code
chunk resumes all the necessary steps:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Severn</span><span class="op">)</span></span>
<span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="va">Severn</span><span class="op">$</span><span class="va">BasinsInfo</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gauge_id"</span>, <span class="st">"downstream_id"</span>, <span class="st">"distance_downstream"</span>, <span class="st">"area"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">nodes</span><span class="op">$</span><span class="va">model</span> <span class="op">&lt;-</span> <span class="st">"RunModel_GR4J"</span></span></code></pre></div>
<p>To notify the SD model that the provided flows on a node should be
directly used instead of an hydrological model, one only needs to
declare its model as <code>NA</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nodes</span><span class="op">$</span><span class="va">model</span><span class="op">[</span><span class="va">nodes</span><span class="op">$</span><span class="va">gauge_id</span> <span class="op">==</span> <span class="st">"54002"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">nodes</span><span class="op">$</span><span class="va">model</span><span class="op">[</span><span class="va">nodes</span><span class="op">$</span><span class="va">gauge_id</span> <span class="op">==</span> <span class="st">"54001"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">griwrmV03</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CreateGRiwrm.html">CreateGRiwrm</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"gauge_id"</span>, down <span class="op">=</span> <span class="st">"downstream_id"</span>, length <span class="op">=</span> <span class="st">"distance_downstream"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">griwrmV03</span></span>
<span><span class="co">#&gt;      id  down length    area         model donor</span></span>
<span><span class="co">#&gt; 4 54095 54001     42 3722.68 RunModel_GR4J 54095</span></span>
<span><span class="co">#&gt; 6 54029 54032     32 1483.65 RunModel_GR4J 54029</span></span>
<span><span class="co">#&gt; 2 54032 54057     15 6864.88 RunModel_GR4J 54032</span></span>
<span><span class="co">#&gt; 1 54057  &lt;NA&gt;     NA 9885.46 RunModel_GR4J 54057</span></span>
<span><span class="co">#&gt; 3 54001 54032     45 4329.90          &lt;NA&gt; 54001</span></span>
<span><span class="co">#&gt; 5 54002 54057     43 2207.95          &lt;NA&gt; 54002</span></span></code></pre></div>
<p>Here, we keep the area of this basin which means that the discharge
will be provided in mm per time step. If the discharge is provided in
m<sup>3</sup>/s, then the area should be set to <code>NA</code> and
downstream basin areas should be modified subsequently.</p>
<p>The diagram of the network structure is represented below with:</p>
<ul>
<li>in blue, the upstream nodes with a GR4J model</li>
<li>in green, the intermediate nodes with an SD (GR4J + LAG) model</li>
<li>in red, the node with direct flow injection (no hydrological
model)</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">griwrmV03</span><span class="op">)</span></span></code></pre></div>
<p><img src="V03_Open-loop_influenced_flow_files/figure-html/diagram-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="generation-of-the-griwrminputsmodel-object">Generation of the GRiwrmInputsModel object<a class="anchor" aria-label="anchor" href="#generation-of-the-griwrminputsmodel-object"></a>
</h4>
<p>The formatting of the input data is described in the vignette
“V01_Structure_SD_model”. The following code chunk resumes this
formatting procedure:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BasinsObs</span> <span class="op">&lt;-</span> <span class="va">Severn</span><span class="op">$</span><span class="va">BasinsObs</span></span>
<span><span class="va">DatesR</span> <span class="op">&lt;-</span> <span class="va">BasinsObs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">DatesR</span></span>
<span><span class="va">PrecipTot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">BasinsObs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">$</span><span class="va">precipitation</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">PotEvapTot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">BasinsObs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">$</span><span class="va">peti</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Precip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConvertMeteoSD.html">ConvertMeteoSD</a></span><span class="op">(</span><span class="va">griwrmV03</span>, <span class="va">PrecipTot</span><span class="op">)</span></span>
<span><span class="va">PotEvap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConvertMeteoSD.html">ConvertMeteoSD</a></span><span class="op">(</span><span class="va">griwrmV03</span>, <span class="va">PotEvapTot</span><span class="op">)</span></span>
<span><span class="va">Qobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">BasinsObs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">$</span><span class="va">discharge_spec</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This time, we need to provide observed flows as inputs for the nodes
‘54002’ and ‘54095’:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">QobsInputs</span> <span class="op">&lt;-</span> <span class="va">Qobs</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"54001"</span>, <span class="st">"54002"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Then, the <code>GRiwrmInputsModel</code> object can be generated
taking into account the new <code>GRiwrm</code> object:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IM_OL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CreateInputsModel.html">CreateInputsModel</a></span><span class="op">(</span><span class="va">griwrmV03</span>, <span class="va">DatesR</span>, <span class="va">Precip</span>, <span class="va">PotEvap</span>, <span class="va">QobsInputs</span><span class="op">)</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Processing sub-basin 54095...</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Processing sub-basin 54029...</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Processing sub-basin 54032...</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Processing sub-basin 54057...</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="calibration-of-the-new-model">Calibration of the new model<a class="anchor" aria-label="anchor" href="#calibration-of-the-new-model"></a>
</h3>
<p>Calibration options is detailed in vignette
“V02_Calibration_SD_model”. We also apply a parameter regularization
here but only where an upstream simulated catchment is available.</p>
<p>The following code chunk resumes this procedure:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IndPeriod_Run</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">DatesR</span> <span class="op">==</span> <span class="op">(</span><span class="va">DatesR</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">365</span><span class="op">*</span><span class="fl">24</span><span class="op">*</span><span class="fl">60</span><span class="op">*</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span>, <span class="co"># Set aside warm-up period</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">DatesR</span><span class="op">)</span> <span class="co"># Until the end of the time series</span></span>
<span><span class="op">)</span></span>
<span><span class="va">IndPeriod_WarmUp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">IndPeriod_Run</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">RunOptions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CreateRunOptions.html">CreateRunOptions</a></span><span class="op">(</span><span class="va">IM_OL</span>,</span>
<span>                               IndPeriod_WarmUp <span class="op">=</span> <span class="va">IndPeriod_WarmUp</span>,</span>
<span>                               IndPeriod_Run <span class="op">=</span> <span class="va">IndPeriod_Run</span><span class="op">)</span></span>
<span><span class="va">InputsCrit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CreateInputsCrit.html">CreateInputsCrit</a></span><span class="op">(</span><span class="va">IM_OL</span>,</span>
<span>                               FUN_CRIT <span class="op">=</span> <span class="va">ErrorCrit_KGE2</span>,</span>
<span>                               RunOptions <span class="op">=</span> <span class="va">RunOptions</span>, Obs <span class="op">=</span> <span class="va">Qobs</span><span class="op">[</span><span class="va">IndPeriod_Run</span>,<span class="op">]</span>,</span>
<span>                               AprioriIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"54057"</span> <span class="op">=</span> <span class="st">"54032"</span>, <span class="st">"54032"</span> <span class="op">=</span> <span class="st">"54029"</span><span class="op">)</span>,</span>
<span>                               transfo <span class="op">=</span> <span class="st">"sqrt"</span>, k <span class="op">=</span> <span class="fl">0.15</span></span>
<span><span class="op">)</span></span>
<span><span class="va">CalibOptions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CreateCalibOptions.html">CreateCalibOptions</a></span><span class="op">(</span><span class="va">IM_OL</span><span class="op">)</span></span></code></pre></div>
<p>The <strong>airGR</strong> calibration process is applied on each
hydrological node of the <code>GRiwrm</code> network from upstream nodes
to downstream nodes.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OC_OL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/Calibration.html">Calibration</a></span><span class="op">(</span><span class="va">IM_OL</span>, <span class="va">RunOptions</span>, <span class="va">InputsCrit</span>, <span class="va">CalibOptions</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Calibration.GRiwrmInputsModel: Processing sub-basin '54095'...</span></span>
<span><span class="co">#&gt; Grid-Screening in progress (0% 20% 40% 60% 80% 100%)</span></span>
<span><span class="co">#&gt;   Screening completed (81 runs)</span></span>
<span><span class="co">#&gt;       Param =  247.151,   -0.020,   83.096,    2.384</span></span>
<span><span class="co">#&gt;       Crit. KGE2[sqrt(Q)] = 0.9507</span></span>
<span><span class="co">#&gt; Steepest-descent local search in progress</span></span>
<span><span class="co">#&gt;   Calibration completed (37 iterations, 377 runs)</span></span>
<span><span class="co">#&gt;       Param =  305.633,    0.061,   48.777,    2.733</span></span>
<span><span class="co">#&gt;       Crit. KGE2[sqrt(Q)] = 0.9578</span></span>
<span><span class="co">#&gt; Calibration.GRiwrmInputsModel: Processing sub-basin '54029'...</span></span>
<span><span class="co">#&gt; Grid-Screening in progress (0% 20% 40% 60% 80% 100%)</span></span>
<span><span class="co">#&gt;   Screening completed (81 runs)</span></span>
<span><span class="co">#&gt;       Param =  247.151,   -0.020,   42.098,    1.944</span></span>
<span><span class="co">#&gt;       Crit. KGE2[sqrt(Q)] = 0.9541</span></span>
<span><span class="co">#&gt; Steepest-descent local search in progress</span></span>
<span><span class="co">#&gt;   Calibration completed (32 iterations, 333 runs)</span></span>
<span><span class="co">#&gt;       Param =  214.204,   -0.119,   46.754,    2.022</span></span>
<span><span class="co">#&gt;       Crit. KGE2[sqrt(Q)] = 0.9696</span></span>
<span><span class="co">#&gt; A priori parameters from node 54029: 1, 214.204, -0.119, 46.754, 1.823</span></span>
<span><span class="co">#&gt; Crit. KGE2[sqrt(Q)] = 0.9696</span></span>
<span><span class="co">#&gt;  SubCrit. KGE2[sqrt(Q)] cor(sim, obs, "pearson") = 0.9697 </span></span>
<span><span class="co">#&gt;  SubCrit. KGE2[sqrt(Q)] cv(sim)/cv(obs)          = 0.9975 </span></span>
<span><span class="co">#&gt;  SubCrit. KGE2[sqrt(Q)] mean(sim)/mean(obs)      = 0.9989 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calibration.GRiwrmInputsModel: Processing sub-basin '54032'...</span></span>
<span><span class="co">#&gt; Grid-Screening in progress (0% 20% 40% 60% 80% 100%)</span></span>
<span><span class="co">#&gt;   Screening completed (243 runs)</span></span>
<span><span class="co">#&gt;       Param =    1.250,  432.681,   -0.020,   42.098,    1.944</span></span>
<span><span class="co">#&gt;       Crit. Composite    = 0.9861</span></span>
<span><span class="co">#&gt; Steepest-descent local search in progress</span></span>
<span><span class="co">#&gt;   Calibration completed (17 iterations, 395 runs)</span></span>
<span><span class="co">#&gt;       Param =    1.110,  395.440,    0.000,   60.340,    1.788</span></span>
<span><span class="co">#&gt;       Crit. Composite    = 0.9876</span></span>
<span><span class="co">#&gt;  Formula: sum(0.85 * KGE2[sqrt(Q)], 0.15 * GAPX[ParamT])</span></span>
<span><span class="co">#&gt; A priori parameters from node 54032: 1.11, 395.44, 0, 60.34, 1.655</span></span>
<span><span class="co">#&gt; Crit. KGE2[sqrt(Q)] = 0.9913</span></span>
<span><span class="co">#&gt;  SubCrit. KGE2[sqrt(Q)] cor(sim, obs, "pearson") = 0.9916 </span></span>
<span><span class="co">#&gt;  SubCrit. KGE2[sqrt(Q)] cv(sim)/cv(obs)          = 1.0020 </span></span>
<span><span class="co">#&gt;  SubCrit. KGE2[sqrt(Q)] mean(sim)/mean(obs)      = 1.0010 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calibration.GRiwrmInputsModel: Processing sub-basin '54057'...</span></span>
<span><span class="co">#&gt; Grid-Screening in progress (0% 20% 40% 60% 80% 100%)</span></span>
<span><span class="co">#&gt;   Screening completed (243 runs)</span></span>
<span><span class="co">#&gt;       Param =    1.250,  247.151,   -0.020,   42.098,    1.944</span></span>
<span><span class="co">#&gt;       Crit. Composite    = 0.9786</span></span>
<span><span class="co">#&gt; Steepest-descent local search in progress</span></span>
<span><span class="co">#&gt;   Calibration completed (23 iterations, 452 runs)</span></span>
<span><span class="co">#&gt;       Param =    1.120,  230.442,   -0.242,   42.521,    1.710</span></span>
<span><span class="co">#&gt;       Crit. Composite    = 0.9797</span></span>
<span><span class="co">#&gt;  Formula: sum(0.85 * KGE2[sqrt(Q)], 0.15 * GAPX[ParamT])</span></span>
<span><span class="va">ParamV03</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">griwrmV03</span><span class="op">$</span><span class="va">id</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="va">OC_OL</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Param</span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-of-the-model-with-this-newly-calibrated-parameters">Run of the model with this newly calibrated parameters<a class="anchor" aria-label="anchor" href="#run-of-the-model-with-this-newly-calibrated-parameters"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OM_OL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunModel.html">RunModel</a></span><span class="op">(</span></span>
<span>  <span class="va">IM_OL</span>,</span>
<span>  RunOptions <span class="op">=</span> <span class="va">RunOptions</span>,</span>
<span>  Param <span class="op">=</span> <span class="va">ParamV03</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Processing sub-basin 54095...</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Processing sub-basin 54029...</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Processing sub-basin 54032...</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Processing sub-basin 54057...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting-of-the-results">Plotting of the results<a class="anchor" aria-label="anchor" href="#plotting-of-the-results"></a>
</h3>
<p>As can be seen below, compared to results of vignette
“V02_Calibration_SD_model”, the use of measured flows on upstream
influenced basins largely improves the model performance at downstream
stations (better low-flow simulations).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">OM_OL</span>, Qobs <span class="op">=</span> <span class="va">Qobs</span><span class="op">[</span><span class="va">IndPeriod_Run</span>, <span class="op">]</span>, which <span class="op">=</span> <span class="st">"Regime"</span><span class="op">)</span></span></code></pre></div>
<p><img src="V03_Open-loop_influenced_flow_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;"><img src="V03_Open-loop_influenced_flow_files/figure-html/unnamed-chunk-8-2.png" width="70%" style="display: block; margin: auto;"><img src="V03_Open-loop_influenced_flow_files/figure-html/unnamed-chunk-8-3.png" width="70%" style="display: block; margin: auto;"><img src="V03_Open-loop_influenced_flow_files/figure-html/unnamed-chunk-8-4.png" width="70%" style="display: block; margin: auto;"></p>
<p>The resulting flows of each node in m<sup>3</sup>/s are directly
available and can be plotted with these commands:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Qm3s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">OM_OL</span>, <span class="st">"Qm3s"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Qm3s</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">150</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="V03_Open-loop_influenced_flow_files/figure-html/unnamed-chunk-9-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-higgsHydrologicalChangesRiver1988" class="csl-entry">
Higgs, Gary, and Geoff Petts. 1988. <span>“Hydrological Changes and
River Regulation in the <span>UK</span>.”</span> <em>Regulated Rivers:
Research &amp; Management</em> 2 (3): 349–68. <a href="https://doi.org/10.1002/rrr.3450020312" class="external-link">https://doi.org/10.1002/rrr.3450020312</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Dorchies.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
