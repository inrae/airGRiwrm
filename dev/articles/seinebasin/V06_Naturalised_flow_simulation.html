<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seine_06: Simulate naturalized flows with a model network calibrated with influenced flows • airGRiwrm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Seine_06: Simulate naturalized flows with a model network calibrated with influenced flows">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">airGRiwrm</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.6.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../articles/airGRiwrm.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li class="dropdown-header">Quick start on the Severn River (UK)</li>
    <li>
      <a href="../../articles/V01_Structure_SD_model.html">Severn_01: Set up of a semi-distributed GR model network</a>
    </li>
    <li>
      <a href="../../articles/V02_Calibration_SD_model.html">Severn_02: Calibration of a GR4J semi-distributed model network</a>
    </li>
    <li>
      <a href="../../articles/V03_Open-loop_influenced_flow.html">Severn_03: Calibration of an open-loop influenced flow model network</a>
    </li>
    <li>
      <a href="../../articles/V04_Closed-loop_regulated_withdrawal.html">Severn_04: Modeling a regulated withdrawal (closed-loop control)</a>
    </li>
    <li>
      <a href="../../articles/V05_Modelling_ungauged_nodes.html">Severn_05: Modeling ungauged stations</a>
    </li>
    <li>
      <a href="../../articles/V06_Modelling_regulated_diversion.html">Severn_06: Modeling a regulated diversion</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Example of a large network on the Seine River (France)</li>
    <li>
      <a href="../../articles/seinebasin/V01_First_network.html">Seine_01: Structuration of a semi-distributed GR4J model network</a>
    </li>
    <li>
      <a href="../../articles/seinebasin/V02_First_run.html">Seine_02: Run a semi-distributed GR model network</a>
    </li>
    <li>
      <a href="../../articles/seinebasin/V03_First_Calibration.html">Seine_03: Calibration of a semi-distributed GR model network</a>
    </li>
    <li>
      <a href="../../articles/seinebasin/V04_Open-loop_influenced_flow.html">Seine_04: Running open-loop influenced flow semi-distributed model network</a>
    </li>
    <li>
      <a href="../../articles/seinebasin/V05_Open-loop_influenced_flow_calibration.html">Seine_05: Calibration of an open-loop influenced flow semi-distributed model network</a>
    </li>
    <li>
      <a href="../../articles/seinebasin/V05b_Open-loop_influenced_flow_calibration_GR6J.html">Seine_05b: Calibration of an open-loop influenced flow semi-distributed GR6J model network</a>
    </li>
    <li>
      <a href="../../articles/seinebasin/V06_Naturalised_flow_simulation.html">Seine_06: Simulate naturalized flows with a model network calibrated with influenced flows</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    airGR Galaxy

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://hydrogr.github.io/airGR/" class="external-link">airGR</a>
    </li>
    <li>
      <a href="https://CRAN.R-project.org/package=airGRdatassim" class="external-link">airGRdatassim R-package</a>
    </li>
    <li>
      <a href="https://sunshine.irstea.fr/app/airGRmaps" class="external-link">airGRmaps web app</a>
    </li>
    <li>
      <a href="https://hydroGR.github.io/airGRteaching/" class="external-link">airGRteaching R-package</a>
    </li>
    <li>
      <a href="https://sunshine.irstea.fr/app/airGRteaching" class="external-link">airGRteaching web app</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/inrae/airGRiwrm" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
<li>
  <a href="https://gitlab.irstea.fr/in-wop/airGRiwrm" class="external-link">
    <span class="fab fa-gitlab fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Seine_06: Simulate naturalized flows with a
model network calibrated with influenced flows</h1>
            
      
      <small class="dont-index">Source: <a href="https://gitlab.irstea.fr/in-wop/airGRiwrm/-/blob/master/vignettes/seinebasin/V06_Naturalised_flow_simulation.Rmd" class="external-link"><code>vignettes/seinebasin/V06_Naturalised_flow_simulation.Rmd</code></a></small>
      <div class="hidden name"><code>V06_Naturalised_flow_simulation.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inrae.github.io/airGRiwrm/">airGRiwrm</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: airGR</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'airGRiwrm'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:airGR':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Calibration, CreateCalibOptions, CreateInputsCrit,</span></span>
<span><span class="co">#&gt;     CreateInputsModel, CreateRunOptions, RunModel</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">seinebasin</span><span class="op">)</span></span></code></pre></div>
<p>This vignette aims at showing an example of flow naturalization by
modeling <span class="citation">(Terrier et al. 2020)</span>.</p>
<p>By using the model calibrated with influenced flows on the Marne
River, it is now possible to model naturalized flows by dropping the
connections to the Marne reservoir from the model. Please note that this
is not the only way to remove the influence of reservoirs.</p>
<div class="section level3">
<h3 id="set-the-data">Set the data<a class="anchor" aria-label="anchor" href="#set-the-data"></a>
</h3>
<p>We first load the naturalized data and influenced flow calibrated
parameters (for GR4J, see
<code>vignette("V05_Open-loop_influenced_flow_calibration", package = "airGRiwrm")</code>):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Input data for the model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"_cache/V01.RData"</span><span class="op">)</span></span>
<span><span class="co"># Calibration in influenced flows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"_cache/V05.RData"</span><span class="op">)</span></span></code></pre></div>
<p>We must remove the lag parameter in the <code>STDIZ_04</code> station
because there is no longer upstream node on it since we remove the only
upstream element for this station, a reservoir uptake:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Param6</span> <span class="op">&lt;-</span> <span class="va">Param5</span></span>
<span><span class="va">Param6</span><span class="op">$</span><span class="va">STDIZ_04</span> <span class="op">&lt;-</span> <span class="va">Param6</span><span class="op">$</span><span class="va">STDIZ_04</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>We remove extra items from a complete configuration to keep only the
Marne system:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selectedNodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"STDIZ_04"</span>, <span class="st">"LOUVE_19"</span>, <span class="st">"VITRY_25"</span>, <span class="st">"CHALO_21"</span>, <span class="st">"MONTR_18"</span>, <span class="st">"NOISI_17"</span><span class="op">)</span></span>
<span><span class="va">griwrm4</span> <span class="op">&lt;-</span> <span class="va">griwrm</span><span class="op">[</span><span class="va">griwrm</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">selectedNodes</span>,<span class="op">]</span></span>
<span><span class="va">griwrm4</span><span class="op">[</span><span class="va">griwrm4</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="st">"NOISI_17"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"down"</span>, <span class="st">"length"</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span> <span class="co"># Downstream station instead of PARIS_05</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">griwrm4</span><span class="op">)</span></span></code></pre></div>
<p><img src="V06_Naturalised_flow_simulation_files/figure-html/griwrm4-1.png" width="700"></p>
<p>We can now generate the new <code>GRiwrmInputsModel</code>
object:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">QNAT</span><span class="op">)</span></span>
<span><span class="va">InputsModel4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/CreateInputsModel.html">CreateInputsModel</a></span><span class="op">(</span><span class="va">griwrm4</span>,</span>
<span>                                  <span class="va">DatesR</span>,</span>
<span>                                  <span class="va">Precip</span><span class="op">[</span>, <span class="va">selectedNodes</span><span class="op">]</span>,</span>
<span>                                  <span class="va">PotEvap</span><span class="op">[</span>, <span class="va">selectedNodes</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Processing sub-basin STDIZ_04...</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Processing sub-basin MONTR_18...</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Processing sub-basin LOUVE_19...</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Processing sub-basin VITRY_25...</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Processing sub-basin CHALO_21...</span></span>
<span><span class="co">#&gt; CreateInputsModel.GRiwrm: Processing sub-basin NOISI_17...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="griwmrunoptions-object">GriwmRunOptions object<a class="anchor" aria-label="anchor" href="#griwmrunoptions-object"></a>
</h3>
<p>We first define the run period:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IndPeriod_Run</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">366</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">DatesR</span><span class="op">)</span><span class="op">)</span> <span class="co"># Until the end of the time series</span></span></code></pre></div>
<p>We define the (optional but recommended) warm up period as a one-year
period before the run period:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IndPeriod_WarmUp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">IndPeriod_Run</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RunOptions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/CreateRunOptions.html">CreateRunOptions</a></span><span class="op">(</span></span>
<span>  <span class="va">InputsModel4</span>,</span>
<span>  IndPeriod_WarmUp <span class="op">=</span> <span class="va">IndPeriod_WarmUp</span>,</span>
<span>  IndPeriod_Run <span class="op">=</span> <span class="va">IndPeriod_Run</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-model-with-michel-calibration">Run model with Michel calibration<a class="anchor" aria-label="anchor" href="#run-model-with-michel-calibration"></a>
</h3>
<p>We keep the optimized parameter values obtained in
<code>vignette("V05_Open-loop_influenced_flow_calibration", package = "airGRiwrm")</code>
and run the model:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OutputsModels4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/RunModel.html">RunModel</a></span><span class="op">(</span></span>
<span>  <span class="va">InputsModel4</span>,</span>
<span>  RunOptions <span class="op">=</span> <span class="va">RunOptions</span>,</span>
<span>  Param <span class="op">=</span> <span class="va">Param6</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Processing sub-basin STDIZ_04...</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Processing sub-basin MONTR_18...</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Processing sub-basin LOUVE_19...</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Processing sub-basin VITRY_25...</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Processing sub-basin CHALO_21...</span></span>
<span><span class="co">#&gt; RunModel.GRiwrmInputsModel: Processing sub-basin NOISI_17...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compare-simulated-naturalized-flow-with-the-ones-given-by-eptb-sgl">Compare simulated naturalized flow with the ones given by EPTB
SGL<a class="anchor" aria-label="anchor" href="#compare-simulated-naturalized-flow-with-the-ones-given-by-eptb-sgl"></a>
</h3>
<p>We can finally compare the simulated naturalized flow with the ones
given by <span class="citation">Hydratec (2011)</span>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">OutputsModels4</span>, Qobs <span class="op">=</span> <span class="va">Qnat</span><span class="op">[</span><span class="va">IndPeriod_Run</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="V06_Naturalised_flow_simulation_files/figure-html/plot-1.png" width="768"><img src="V06_Naturalised_flow_simulation_files/figure-html/plot-2.png" width="768"><img src="V06_Naturalised_flow_simulation_files/figure-html/plot-3.png" width="768"><img src="V06_Naturalised_flow_simulation_files/figure-html/plot-4.png" width="768"><img src="V06_Naturalised_flow_simulation_files/figure-html/plot-5.png" width="768"><img src="V06_Naturalised_flow_simulation_files/figure-html/plot-6.png" width="768"></p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-hydratecActualisationBaseDonnees2011a" class="csl-entry">
Hydratec. 2011. <span>“Actualisation de La Base de Données Des Débits
Journaliers <span>‘Naturalisés’</span> - <span>Phase</span> 2.”</span>
26895 - LME/TL.
</div>
<div id="ref-terrierStreamflowNaturalizationMethods2020" class="csl-entry">
Terrier, Morgane, Charles Perrin, Alban de Lavenne, Vazken Andréassian,
Julien Lerat, and Jai Vaze. 2020. <span>“Streamflow Naturalization
Methods: A Review.”</span> <em>Hydrological Sciences Journal</em>,
November, 1–25. <a href="https://doi.org/10.1080/02626667.2020.1839080" class="external-link">https://doi.org/10.1080/02626667.2020.1839080</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Dorchies.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
